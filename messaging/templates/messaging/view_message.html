{% extends 'users/base.html' %}
{% load static %}
{% block title %}View Message{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
    .message-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 15px;
    }
    .message-body {
        padding: 20px;
        white-space: pre-wrap;
    }
    .message-footer {
        background-color: #f8f9fa;
        border-top: 1px solid #dee2e6;
        padding: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header message-header">
            <h2 class="mb-3">{{ message.subject }}</h2>
            <div class="row">
                <div class="col-md-8">
                    <p><strong>From:</strong> {{ message.sender.get_full_name }}</p>
                    <p><strong>To:</strong>
                        {% for recipient in message.recipients.all %}
                            {{ recipient.get_full_name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                    {% if message.cc.all %}
                        <p><strong>CC:</strong>
                            {% for cc_recipient in message.cc.all %}
                                {{ cc_recipient.get_full_name }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                    {% endif %}
                    {% if message.study_name %}
                        <p><strong>Study Name:</strong> {{ message.study_name }}</p>
                    {% endif %}
                    {% if message.related_submission %}
                        <p><strong>Related Submission:</strong>
                            <a href="{% url 'submission:submission_detail' message.related_submission.id %}">
                                {{ message.related_submission.title }}
                            </a>
                        </p>
                    {% endif %}
                    <p><strong>Sent At:</strong> {{ message.sent_at|date:"F d, Y H:i" }}</p>
                    {% if message.hashtags %}
                        <p><strong>Hashtags:</strong> {{ message.hashtags }}</p>
                    {% endif %}
                </div>
                <div class="col-md-4 text-md-right">
                    <!-- Additional info can be placed here if needed -->
                </div>
            </div>
        </div>
        <div class="card-body message-body">
            {{ message.body|linebreaks }}
        </div>
        <div class="card-footer message-footer">
            <div class="btn-group" role="group">
                <a href="{% url 'messaging:reply' message.id %}" class="btn btn-primary">Reply</a>
                <a href="{% url 'messaging:reply_all' message.id %}" class="btn btn-secondary">Reply All</a>
                <a href="{% url 'messaging:forward' message.id %}" class="btn btn-info">Forward</a>
                <form method="post" action="{% url 'messaging:archive_message' %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="message_ids" value="{{ message.id }}">
                    <button type="submit" class="btn btn-warning" onclick="return confirm('Are you sure you want to archive this message?');">Archive</button>
                </form>
            </div>
        </div>
    </div>
    <a href="{% url 'messaging:inbox' %}" class="btn btn-secondary mt-3">Back to Inbox</a>
</div>
{% endblock %}
